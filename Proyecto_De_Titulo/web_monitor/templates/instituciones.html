{% extends 'sideNavbar.html' %}

{% block title %}FACSA{% endblock %}

{% block content %}

<h1 class="text-primary">Cargando Instituciones </h1>
<p>Plataforma de adquisición de parámetros de voz y variables ambientales.</p>
<p>Instituciones que participan en el proyecto:</p>

<!--
    rut_institucion = models.CharField(max_length=12, unique=True)
    nombre_institucion = models.CharField(max_length=50, unique=True)
    direccion = models.CharField(max_length=50, null=False, blank=False)
    sitio_web = models.CharField(max_length=50, null=True, blank=True)
    representante_legal = models.CharField(max_length=50, null=False, blank=False)
    telefono_institucion = models.CharField(max_length=12, null=False, blank=False)
    correo_institucion = models.EmailField(max_length=50, null=False, blank=False, unique=True)            
    
    Mostrar una sola tabla con los datos de todas la instituciones
    [Boton agrgar]
    tabla: 
    nombre_institucion,,rut_institucion,  direccion, [boton detalle],[boton editar], [boton eliminar]
    nombre_institucion,,rut_institucion,  direccion, [boton detalle],[boton editar], [boton eliminar]
    nombre_institucion,,rut_institucion,  direccion, [boton detalle],[boton editar], [boton eliminar]
    ...
-->
<div class="card mb-3">
    <div class="card-body">

        <div class="table-responsive">
            <table class="table table-bordered table-hover">
                <thead>
                    <tr>
                        <th>Nombre Institución</th>
                        <th>Rut Institución</th>
                        <th>Dirección</th>
                        <th>Teléfono</th>
                        <th>Correo Electrónico</th>
                        <th>Detalle</th>
                        <th>Editar</th>
                        <th>Eliminar</th>
                    </tr>
                </thead>
                <tbody>
                    {% for institucion in page_obj %}
                    <tr>
                        <td>{{ institucion.nombre_institucion }}</td>
                        <td>{{ institucion.rut_institucion }}</td>
                        <td>{{ institucion.direccion }}</td>
                        <td>{{ institucion.telefono_institucion }}</td>
                        <td>{{ institucion.correo_institucion }}</td>
                        <td class="text-center">
                            <a href=""><i class="far fa-file-alt"></i></a>
                        </td>
                        <td class="text-center">
                            <a href=""><i class="fas fa-file-signature"></i></a>
                        </td>




                        <td class="text-center">
                            
                            
                            <a href="{% url 'eliminar_institucion' institucion.pk %}" 
                                class="text-danger" 
                                data-bs-toggle="modal"
                                data-bs-target="#confirmarEliminacionModal"
                                data-url="{% url 'eliminar_institucion' institucion.pk %}"
                                data-nombre="{{ institucion.nombre_institucion }}">
                                <i class="far fa-trash-alt"></i>
                        </a>



                        </td>
                    </tr>
                    {% endfor %}
                </tbody>

                
                
            </table>
            <div class="pagination justify-content-center mt-4">
                <nav>
                    <ul class="pagination">
                        {% if page_obj.has_previous %}
                        <li class="page-item">
                            <a class="page-link" href="?page={{ page_obj.previous_page_number }}">&laquo;</a>
                        </li>
                        {% endif %}
            
                        {% for page in page_range %}
                            {% if page == '…' %}
                                <li class="page-item disabled"><span class="page-link">…</span></li>
                            {% elif page == page_obj.number %}
                                <li class="page-item active"><span class="page-link">{{ page }}</span></li>
                            {% else %}
                                <li class="page-item"><a class="page-link" href="?page={{ page }}">{{ page }}</a></li>
                            {% endif %}
                        {% endfor %}
            
                        {% if page_obj.has_next %}
                        <li class="page-item">
                            <a class="page-link" href="?page={{ page_obj.next_page_number }}">&raquo;</a>
                        </li>
                        {% endif %}
                    </ul>
                </nav>
            </div>
        </div>
    </div>
</div>          

<!-- Modal -->
<!-- Modal de Confirmación -->
<div class="modal fade" id="confirmarEliminacionModal" tabindex="-1" aria-labelledby="confirmarEliminacionLabel" aria-hidden="true">
    <div class="modal-dialog">
      <div class="modal-content">
        <form method="POST" id="formEliminar">
          {% csrf_token %}
          <div class="modal-header">
            <h5 class="modal-title" id="confirmarEliminacionLabel">Confirmar Eliminación</h5>
            <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Cerrar"></button>
          </div>
          <div class="modal-body">
            ¿Estás seguro que deseas eliminar la institución <strong id="nombreInstitucionEliminar"></strong>?
          </div>
          <div class="modal-footer">
            <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancelar</button>
            <button type="submit" class="btn btn-danger">Eliminar</button>
          </div>
        </form>
      </div>
    </div>
  </div>
  
  
  <script>
    document.addEventListener('DOMContentLoaded', function () {
        const modal = document.getElementById('confirmarEliminacionModal');
        modal.addEventListener('show.bs.modal', function (event) {
            const button = event.relatedTarget;
            const url = button.getAttribute('data-url');
            const nombre = button.getAttribute('data-nombre');
            
            const form = modal.querySelector('#formEliminar');
            const nombreSpan = modal.querySelector('#nombreInstitucionEliminar');
            
            form.action = url;
            nombreSpan.textContent = nombre;
        });
    });
  </script>
  
    

{% endblock %}
